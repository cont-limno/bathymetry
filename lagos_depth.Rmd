---
title: "LAGOS lake depth"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r data, message=FALSE, echo=FALSE}
library(LAGOSNE)
library(ggplot2)
library(sf)
library(dplyr)
library(cowplot)
library(ggforce)


lg       <- lagosne_load("1.087.1")
lg_depth <- dplyr::select(lg$lakes_limno, 
                          lagoslakeid, maxdepth, maxdepthsource) %>% 
  mutate(color = cut(maxdepth, round(quantile(maxdepth, c(0, 0.05, 0.5, 0.95, 1), 
                                                   na.rm = TRUE)))) %>% 
  left_join(lg$locus, by = "lagoslakeid") %>%
  mutate(has_limno = lagoslakeid %in% lg$epi_nutr$lagoslakeid) %>%
  # dplyr::filter(!is.na(maxdepth)) %>%
  coordinatize()
```

```{r summary_stats, echo = FALSE}
paste0(round(sum(!is.na(lg_depth$maxdepth)) / nrow(lg_depth) * 100, 2),
       "% (n=", sum(!is.na(lg_depth$maxdepth)), ") of lakes have maxdepth values.")

paste0(round(sum(dplyr::filter(lg_depth, !is.na(maxdepth))$lagoslakeid %in% 
            lg$epi_nutr$lagoslakeid) / 
        nrow(lg_depth) * 100, 2), 
       "% (n=", sum(dplyr::filter(lg_depth, !is.na(maxdepth))$lagoslakeid %in% 
            lg$epi_nutr$lagoslakeid), ") of lakes with maxdepth values have limno data.")

paste0(round(sum(!is.na(dplyr::filter(lg_depth, has_limno)$maxdepth)) / 
  length(unique(lg$epi_nutr$lagoslakeid)) * 100, 2), 
  "% (n=", sum(!is.na(dplyr::filter(lg_depth, has_limno)$maxdepth)), ") of lakes with limno data have maxdepth values.")
```

```{r viz, echo=FALSE, warning=FALSE, message=FALSE, fig.height=3}
knitr::kable(t(quantile(lg_depth$maxdepth, c(0, 0.05, 0.5, 0.95, 1), 
                        na.rm = TRUE)), caption = "Lake depth quantiles")
knitr::kable(round(t(quantile(lg_depth$lake_area_ha, c(0, 0.05, 0.5, 0.95, 1), 
                        na.rm = TRUE)), 2), caption = "Lake area quantiles")

cowplot::plot_grid(
  ggplot(data = dplyr::filter(lg_depth, !is.na(lake_area_ha), !is.na(maxdepth))) + 
    geom_mark_rect(aes(fill = "", x = lake_area_ha, y = maxdepth,
                     filter = maxdepth <= 26 & lake_area_ha <= 53), inherit.aes = FALSE) +
  geom_point(aes(x = lake_area_ha, y = maxdepth)) +
  theme_minimal_grid() + theme(legend.position = 0, 
                               axis.text.x = element_text(angle = 90)) +
  scale_x_log10(expand = c(0, 0)) + 
    scale_y_continuous(expand = c(0, 0), limits = c(0, 100)) +
  xlab("log(Lake Area)"), 
  ggplot() + 
    geom_point(data = dplyr::filter(lg_depth, lake_area_ha < 53, maxdepth < 26), 
               aes(x = lake_area_ha, y = maxdepth)) +
    theme_minimal_grid() + 
      xlab("Lake Area")
)

```

```{r map, echo=FALSE, message=FALSE, error = FALSE}
states_base <- jsta::get_intersects(jsta::usa_sf(), lg_depth, 
                                    threshold = 1500)

ggplot() + 
  geom_sf(data = states_base) +
  geom_sf(data = dplyr::sample_frac(
    dplyr::filter(lg_depth, !is.na(maxdepth)), 0.3), 
          aes(color = color), 
    size = 1, alpha = 0.4, shape = 20) +
  # scale_color_viridis_d(direction = -1) +
  # scale_color_brewer(palette = "Set2") +
  scale_fill_brewer(palette = "Set2") +
  coord_sf(datum = NA) + theme_void() +
  labs(color = "depth (m)")
```

```{r }
knitr::kable(
  data.frame(stringsAsFactors=FALSE,
  lead_author = c("Hollister", "Heathcote", "Oliver", "Sobek", "Emmerton",
                    "Johansson", "Neumann"),
  year = c(2011L, 2015L, 2016L, 2011L, 2007L, 2007L, 1959L),
  location = c("NE/NY Huc", "Boreal Canada", "LAGOSNE", "Sweden",
                 "Canadian Arctic", "Sweden", "Global"),
  lake_numbers = c(133L, 433L, 7347L, 6618L, 81L, 105L, 107L)
))

```
