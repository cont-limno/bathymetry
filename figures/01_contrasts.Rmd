---
output: pdf_document
header-includes: 
  - \pagenumbering{gobble}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.path = "../figures/", fig.width = 6.5, fig.height = 4.5)
# setwd("figures")
source("../scripts/99_utils.R")
```

```{r gg_depth_shape_class, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE, results='hide'}

dt <- read.csv("../data/00_hypso/hypso_predictors.csv", 
               stringsAsFactors = FALSE)

gg_depth_shape_class <- dt %>%
  dplyr::filter(shape_class != "neither") %>%
  group_by(shape_class) %>%
  summarize(lake_maxdepth_m = list(tibble::enframe(
    quantile(lake_maxdepth_m, probs = c(0.05,0.5,0.95), na.rm = TRUE)))) %>% 
  unnest() %>%
  tidyr::spread(name, value) %>%
  ggplot() +
geom_pointrange(aes(x = shape_class, y = `50%`, 
                      ymin = `5%`, ymax = `95%`)) +
  ylab("Depth (m)") + xlab("")
```

```{r gg_depth_connectivity, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE, results='hide'}

gg_depth_conny_class <- dt %>%
  dplyr::filter(!is.na(lake_connectivity_class)) %>%
  group_by(lake_connectivity_class) %>%
  summarize(lake_maxdepth_m = list(tibble::enframe(
    quantile(lake_maxdepth_m, probs = c(0.05,0.5,0.95), na.rm = TRUE)))) %>% 
  unnest() %>%
  tidyr::spread(name, value) %>%
  ggplot() +
geom_pointrange(aes(x = lake_connectivity_class, y = `50%`, 
                      ymin = `5%`, ymax = `95%`)) +
  ylab("Depth (m)") + xlab("")
```


```{r gg_depth_glaciated, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE, results='hide'}

gg_depth_glaciated_class <- dt %>%
  dplyr::filter(!is.na(lake_glaciatedlatewisc)) %>%
  group_by(lake_glaciatedlatewisc) %>%
  summarize(lake_maxdepth_m = list(tibble::enframe(
    quantile(lake_maxdepth_m, probs = c(0.05,0.5,0.95), na.rm = TRUE)))) %>% 
  unnest() %>%
  tidyr::spread(name, value) %>%
  ggplot() +
geom_pointrange(aes(x = lake_glaciatedlatewisc, y = `50%`, 
                      ymin = `5%`, ymax = `95%`)) +
  ylab("Depth (m)") + xlab("")
```

```{r 01_contrasts_depth, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE, results='hide', fig.height = 3.5}
theme_opts <- theme(axis.text.x = element_text(angle = 90))
  
cowplot::plot_grid(gg_depth_shape_class + 
                     theme_opts, 
                   gg_depth_conny_class + 
                     theme_opts +
                     theme(axis.title.y = element_blank()), 
                   gg_depth_glaciated_class + 
                     theme_opts +
                     theme(axis.title.y = element_blank()), 
                   nrow = 1)
```

```{r gg_tally_profileshapeclass, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE, results='hide'}
# panel histograms that tally number of lakes with max depth by profileshape_class
# include sum across all types

gg_tally_profileshapeclass <- read.csv(
  "../data/00_hypso/hypso_predictors.csv", stringsAsFactors = FALSE) %>% 
  group_by(shape_class) %>%
  tally() %>%
  ggplot() + 
  geom_col(aes(x = shape_class, y = n))
```

```{r gg_tally_programtype, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE, results='hide'}
# panel histograms that tally number of lakes with max depth by programtype_depth
# include sum across all types

gg_tally_programtype <- read.csv(
  "../data/lagosus_depth.csv", stringsAsFactors = FALSE) %>% 
   dplyr::filter(!is.na(lake_maxdepth_m)) %>%
   group_by(programtype_depth) %>% 
   tally() %>% 
   ggplot(aes(x = programtype_depth, y = n)) + 
   geom_col() + 
   geom_text(aes(label = n), vjust = -0.5) + 
   ylim(0, 11000) +
  xlab("Program type")
```


```{r gg_tally_maxdepthclass, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE, results='hide'}
# panel histograms that tally number of lakes with max depth by maxdepth_class
# include sum across all types

dt <- read.csv(
  "../data/lagosus_depth_predictors.csv", stringsAsFactors = FALSE)
max_depth <- dt$lake_maxdepth_m
gg_tally_maxdepthclass <- dt %>%
  mutate(maxdepth_class = 
           smart_cut(lake_maxdepth_m, c(10, 30, 70, 200, max(max_depth)), 
                     brackets = NULL, sep = " - ")
         ) %>%
  group_by(maxdepth_class) %>%
  tally() %>%
  ggplot(aes(x = maxdepth_class, y = n)) +
  geom_col() + 
  geom_text(aes(label = n), vjust = -0.5) +
  ylim(0, 15000) + 
  xlab("Max depth class (m)")
```

```{r gg_tally_waterareaclass, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE, results='hide'}
# panel histograms that tally number of lakes with max depth by waterarea_class
# include sum across all types
gg_tally_waterareaclass <- read.csv("../data/lagosus_depth_predictors.csv", 
               stringsAsFactors = FALSE) %>%
  mutate(area_class =
           smart_cut(lake_waterarea_ha, c(1, 4, 40, 80, 300, 400,
                                               1000, 20000, Inf),
             labels = ~paste(sep="-", thousand_k(.y[1]), thousand_k(.y[2])))
         ) %>%
  group_by(area_class) %>%
  tally() %>%
  ggplot(aes(x = area_class, y = n)) +
  geom_col() + 
  geom_text(aes(label = n), vjust = -0.5) +
  ylim(0, 10000) + 
  xlab("Lake area class (ha)")
```

```{r gg_tally_hypsoclass, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE, results='hide'}
gg_tally_hypsoclass <- read.csv(
  "../data/lagosus_depth_predictors.csv", 
               stringsAsFactors = FALSE) %>%
  dplyr::filter(!is.na(shape_class)) %>%
  distinct(lagoslakeid, shape_class, .keep_all = TRUE) %>%
  group_by(shape_class) %>%
  tally() %>%
  ggplot(aes(x = shape_class, y = n)) +
  geom_col() + 
  geom_text(aes(label = n), vjust = -0.5) +
  ylim(0, 3000) + 
  xlab("Shape class")
```

```{r 01_contrasts_tally, echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE, results='hide', fig.height = 7.6}
cowplot::plot_grid(gg_tally_programtype, gg_tally_maxdepthclass, 
                   gg_tally_waterareaclass, gg_tally_hypsoclass, 
                   ncol = 1)
```
